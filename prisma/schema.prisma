generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Course {
  id           String     @id @default(cuid())
  title        String
  description  String?
  thumbnail    String?
  isPublished  Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  
  chapters    Chapter[]
  quizzes     Quiz[]
  assignments Assignment[]
  chatRooms   ChatRoom[]

  @@index([title], map: "idx_course_title")
  @@index([isPublished], map: "idx_course_isPublished")
}

model Chapter {
  id          String   @id @default(cuid())
  courseId    String
  title       String
  description String?
  content     String?
  videoUrl    String?
  position    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  
  @@index([courseId], map: "idx_chapter_courseId")
}

model Quiz {
  id            String   @id @default(cuid())
  courseId      String
  title         String
  description   String?
  passingScore  Float    @default(70)
  isPublished   Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  course        Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  questions     QuizQuestion[]
  
  @@index([courseId], map: "idx_quiz_courseId")
  @@index([isPublished], map: "idx_quiz_isPublished")
}

model QuizQuestion {
  id              String   @id @default(cuid())
  quizId          String
  question        String
  options         String[]
  correctAnswer   String
  explanation     String?
  position        Int      @default(0)
  createdAt       DateTime @default(now())
  
  quiz            Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  
  @@index([quizId], map: "idx_quizquestion_quizId")
}

model Assignment {
  id          String   @id @default(cuid())
  courseId    String
  title       String
  description String?
  dueDate     DateTime?
  maxScore    Float    @default(100)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  
  @@index([courseId], map: "idx_assignment_courseId")
}

model ChatRoom {
  id          String       @id
  courseId    String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  messages    ChatMessage[]
  course      Course       @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId], map: "idx_chatroom_courseId")
}

model ChatMessage {
  id         String   @id
  chatRoomId String
  senderId   String
  content    String
  createdAt  DateTime @default(now())
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)

  @@index([chatRoomId], map: "idx_chatmessage_chatRoomId")
  @@index([senderId], map: "idx_chatmessage_senderId")
}