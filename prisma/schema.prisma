// Extended Prisma schema with permission system, analytics, and chat models

enum Permission {
  CREATE_COURSE
  EDIT_COURSE
  DELETE_COURSE
  VIEW_COURSE
  SUBMIT_ASSIGNMENT
  GRADE_ASSIGNMENT
  VIEW_ANALYTICS
  MANAGE_USERS
  // Add more permissions as needed
}

model RolePermission {
  id          String      @id @default(cuid())
  role        UserRole
  permission  Permission

  @@unique([role, permission])
}

model UserAction {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  actionType  String
  metadata    Json?
  createdAt   DateTime    @default(now())

  @@index([userId])
  @@index([actionType])
}

model ChatRoom {
  id          String      @id @default(cuid())
  courseId    String
  course      Course      @relation(fields: [courseId], references: [id], onDelete: Cascade)
  messages    ChatMessage[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([courseId])
}

model ChatMessage {
  id          String      @id @default(cuid())
  chatRoomId  String
  chatRoom    ChatRoom    @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
  senderId    String
  sender      User        @relation(fields: [senderId], references: [id])
  content     String
  createdAt   DateTime    @default(now())

  @@index([chatRoomId])
  @@index([senderId])
}

// Retain existing models (User, Course, Lesson, Quiz, etc.) unchanged except for additions above

/// Existing schema copied here for context

// (All existing models are retained without changes except above additions)
